# Render Blueprint for LunorÃ© E-Commerce Platform
# This file defines the infrastructure for deploying both frontend and backend services

services:
  # ============================================
  # BACKEND SERVICE (Node.js/Express API)
  # ============================================
  - type: web
    name: lunore-backend
    runtime: node
    region: singapore
    plan: free
    rootDir: server
    buildCommand: npm install
    startCommand: npm start
    healthCheckPath: /api/health
    
    # Environment variables for backend
    envVars:
      - key: NODE_ENV
        value: production
      
      - key: PORT
        value: 5000
      
      # MongoDB Connection String (REQUIRED - Add in Render Dashboard)
      - key: MONGODB_URI
        sync: false
      
      # JWT Secret (REQUIRED - Add in Render Dashboard)
      - key: JWT_SECRET
        sync: false
      
      # CORS Origin (Add manually after frontend is deployed)
      - key: CORS_ORIGIN
        sync: false

    # Auto-deploy settings
    autoDeploy: true

  # ============================================
  # FRONTEND SERVICE (React/Vite Static Site)
  # ============================================
  - type: web
    name: lunore-frontend
    runtime: static
    plan: free
    buildCommand: npm install && npm run build
    staticPublishPath: dist
    
    # Environment variables for frontend (Add backend URL manually after backend is deployed)
    envVars:
      - key: VITE_API_URL
        sync: false
    
    # Custom headers for security and performance
    headers:
      - path: /*
        name: X-Frame-Options
        value: DENY
      
      - path: /*
        name: X-Content-Type-Options
        value: nosniff
      
      - path: /*
        name: Referrer-Policy
        value: strict-origin-when-cross-origin
      
      - path: /*
        name: Permissions-Policy
        value: geolocation=(), microphone=(), camera=()
      
      # Cache static assets
      - path: /assets/*
        name: Cache-Control
        value: public, max-age=31536000, immutable
    
    # Routes configuration for React Router
    routes:
      - type: rewrite
        source: /*
        destination: /index.html
    
    # Auto-deploy settings
    autoDeploy: true

# ============================================
# DEPLOYMENT STEPS:
# ============================================
# 1. Push this file to your GitHub repository root
# 2. Go to Render Dashboard â†’ New â†’ Blueprint
# 3. Connect your GitHub repository
# 4. After services are created, add these environment variables:
#
#    BACKEND (lunore-backend):
#    - MONGODB_URI: mongodb+srv://user:pass@cluster.mongodb.net/lunore
#    - JWT_SECRET: (generate with: openssl rand -base64 32)
#    - CORS_ORIGIN: https://lunore-frontend.onrender.com (your frontend URL)
#
#    FRONTEND (lunore-frontend):
#    - VITE_API_URL: https://lunore-backend.onrender.com (your backend URL)
#
# 5. Trigger manual redeploy of frontend after adding VITE_API_URL
# 6. Done! Your app is live ðŸŽ‰
